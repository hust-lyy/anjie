<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta name="renderer" content="webkit">
    <meta http-equiv="expires" content="0">
    <meta http-equiv="pragma" content="no-cache">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <title>设备异常登记</title>
    <link rel="stylesheet" href="/static/css/datatables.min.css">
    <link rel="stylesheet" href="/static/css/jedate.css">
    <link rel="stylesheet" href="/static/css/main.css">
    <script src="/static/js/jquery.min.js"></script>
    <script src="/static/js/jquery.dataTables.min.js"></script>
    <script src="/static/js/jedate.js"></script>
    <!--[if lt IE 9]>
    <script src="https://cdn.bootcss.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://cdn.bootcss.com/respond.js/1.4.2/respond.js"></script>
    <![endif]-->
    <style>
        #table_id_example>tbody>tr>td{
            text-align:center;
            box-sizing: border-box;
            height: 49px;
            padding: 0;
            line-height:49px;
        }
        #table_id_example>tbody>tr{
            box-sizing: border-box;
        }
        #table_id_example>thead>tr>th{
            text-align:center;
            box-sizing: border-box;
            height: 49px;
            padding: 0;
            line-height:49px;
            color: #3effff;
        }
        .dataTables_wrapper .dataTables_paginate .paginate_button.disabled{
            color: #3effff !important;
        }
        .dataTables_wrapper .dataTables_paginate .paginate_button.disabled a{
            color: #3effff !important;
        }
        .dataTables_wrapper .dataTables_paginate .paginate_button {
            color: #3effff !important;
            border: 0;
        }
        .dataTables_wrapper .dataTables_paginate .paginate_button:hover{
            background: none;
            color: #3effff;
            border: none;
        }
        #table_id_example_filter>label{
            color: #3effff;
        }
        #table_id_example_filter{
            display: none;
        }
        /*条件搜搜*/
        .condition{
            width:100%;
        }
        .condition>li{
            width:100%;;
        }
        .condition>li> .com{
            padding: 8px 0 8px 0;
            float: left;
            margin-right:20px ;
        }
        .condition>li>.dim{
            padding: 8px 0 8px 0;
            float: left;
            margin-right:20px ;
        }
        table.dataTable.stripe tbody tr.odd, table.dataTable.display tbody tr.odd {
            background-color: #fff;
        }
        table.dataTable.hover tbody tr:hover, table.dataTable.display tbody tr.odd:hover {
            background-color: rgb(246, 246, 246);
        }
        td{
            border-right: 1px solid #ddd;
            background: none;
        }
        tr>td:last-child,tr>th:last-child{
            border-right: 0;
        }
        table.dataTable.display tbody tr.odd>.sorting_1, table.dataTable.order-column.stripe tbody tr.odd>.sorting_1 {
            background-color: rgba(255, 255, 255, 0);
        }
        table.dataTable.display tbody tr.even>.sorting_1, table.dataTable.order-column.stripe tbody tr.even>.sorting_1 {
            background-color: rgba(255, 255, 255, 0);
        }
    </style>
</head>
<body>
<div class="content clearfix">
    <!--顶部title-->
    <div class="main-top clearfix">
        <div class="main-topLeft">
            <img src="/static/image/logo.png" alt="" style="width:100%;">
        </div>
        <div class="" style="float: left;height:1px;width:41.66666667%;"></div>
        <div class="main-topRight">
            <p class="main-topRight-btn">
                <a href="../../../../asdf.html" style="padding-right: 5%">主界面</a>
                <a href="javascript:;" style="border-left: 1px solid #02d4ff;padding-left: 5%" class="esc">退出</a>
            </p>
            <p class="main-topRight-time">2018/00/00<span>01:01:01</span></p>
        </div>
    </div>
    <!--顶部title结束-->
    <div class="row clearfix">
        <!--左侧功能栏开始-->
        <div class="leftnav" style="height:984px;">
            <a class="leftnav-itemTitle nolist"href="index.html">
            <span class="leftnav-itemTitle-zi on">
                首页
            </span>
            </a>

            <a class="leftnav-itemTitle nolist" href="sentrybox.html">
            <span class="leftnav-itemTitle-zi">
                岗亭客户端
            </span>
            </a>

            <a class="leftnav-itemTitle nolist" href="control.html">
            <span class="leftnav-itemTitle-zi">
                控制器状态
            </span>
            </a>

            <div class="leftnav-itemTitle haveList">
            <span class="leftnav-itemTitle-zi">
                数据分析
            </span>
            </div>
            <ul class="leftnav-itemlist">
                <li>
                    <a href="retention.html">长期滞留车辆</a>
                </li>
                <li>
                    <a href="javascript:;">设备异常登记</a>
                </li>
                <li>
                    <a href="vehicleQuery.html">场内车辆查询</a>
                </li>
                <li>
                    <a href="illegality.html">非法开闸查询</a>
                </li>
                <li>
                    <a href="abnormal.html">异常出厂查询</a>
                </li>
                <li>
                    <a href="statistics.html">车流量统计</a>
                </li>
            </ul>
        </div>
        <!--左侧功能栏结束-->
        <!--右侧显示页面开始-->
        <div class="main-content">
            <div class="main-content-right" style="height:984px;">
                <div class="control-title">
                    设备异常登记
                </div>
                <!--表格盒子-->
                <div class="retention-box">
                    <ul style="color:#3effff;" class="condition clearfix">
                        <li class="clearfix">
                            <div class="com">
                                <span>入场时间 :</span>
                                <input id="start" type="text" value=""/>至<input id='end' type="text" value=""/>
                            </div>
                            <div class="com">
                                <span>异常类型 :</span>
                                <select name="" id="anomalyType">
                                    <option value="所有">所有</option>
                                    <option value="离线">离线</option>
                                    <option value="故障">故障</option>
                                    <option value="维修">维修</option>
                                </select>
                            </div>
                            <!--<div class="com">-->
                            <!--<button>查询</button>-->
                            <!--</div>-->
                            <div class="com">
                                <button class="add">新增</button>
                                <!--<button class="compile">编辑</button>-->
                                <button class="del">删除</button>
                            </div>
                        </li>
                    </ul>
                    <table id="table_id_example" class="display">

                    </table>
                </div>
                <div class="cover">
                    <div class="cover-text">
                        <div class="control-title1">
                            异常设备编辑
                        </div>
                        <div class="cover-content">
                            <div class="cover-content-list clearfix">
                                <div style="width:90px;box-sizing: border-box;padding: 5px;float: left;text-align: right">设备编号:</div>
                                <div style="float: left;width:390px;"><input type="text" style="width:100%;" id="equipmentNum"></div>
                            </div>
                            <div class="cover-content-list clearfix">
                                <div style="width:90px;box-sizing: border-box;padding: 5px;float: left;text-align: right">设备名称:</div>
                                <div style="float: left;width:390px;"><input type="text" style="width:100%;" id="equipmentName"></div>
                            </div>
                            <div class="cover-content-list clearfix">
                                <div style="width:90px;box-sizing: border-box;padding: 5px;float: left;text-align: right">发生时间:</div>
                                <div style="float: left;width:390px;"><input type="text" style="width:100%;" id="startTime"></div>
                            </div>
                            <div class="cover-content-list clearfix">
                                <div style="width:90px;box-sizing: border-box;padding: 5px;float: left;text-align: right">操作员:</div>
                                <div style="float: left;width:390px;"><input type="text" style="width:100%;" id="master"></div>
                            </div>
                            <div class="cover-content-list clearfix">
                                <div style="width:90px;box-sizing: border-box;padding: 5px;float: left;text-align: right">异常类型:</div>
                                <div style="float: left;width:390px;">
                                    <select name="" id="equipmentInfo">
                                        <option value="离线">离线</option>
                                        <option value="故障">故障</option>
                                        <option value="维修">维修</option>
                                    </select>
                                </div>
                            </div>
                            <div class="cover-content-list clearfix" style="text-align: center">
                                <button style="margin:0 5px" id="save">保存</button>
                                <button style="margin:0 5px" id="cancel">取消</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
        <!--右侧显示页面结束-->
    </div>
</div>
<div class="closeWindow">
    <div class="closeWindow-content">
        <p>点击确认，将退出登录</p>
        <div class="close">关闭</div>
        <div class="off">取消</div>
    </div>
</div>
</body>
<script>
    $(document).ready(function(){
        //        点击退出登录按钮
        $(".esc").click(function(){
            $(".closeWindow").css('display','block');
        });
//        点击退出
        $(".close").click(function(){
            window.location.href='../../../../default.html'
        });
//点击取消
        $(".off").click(function(){
            $(".closeWindow").css('display','none');
        });

        //        顶部获取时间
        function settime1(){
            var mydate = new Date()
            var n =mydate.toLocaleString();
            $(".main-topRight-time").html(n);
        };
        // 获取时间
        settime1();
        var getTime1=setInterval(settime1,1000);


        var data=[
            {
                check:'<input type="checkbox" class="checkchild"/>',
                '':'',
                'deviceNum':'n12123',
                'deviceType':'设备1',
                'beginTime' :'2017-04-04 14:18:20',
                'error' :'离线',
                'operator':'操作员A',
                'edit':'<button class="compile">编辑</button>'
            },
            {
                check:'<input type="checkbox" class="checkchild"/>',
                '':'',
                'deviceNum':'n12123',
                'deviceType':'设备2',
                'beginTime' :'2010-04-04 14:18:20',
                'error' :'维修',
                'operator':'操作员b',
                'edit':'<button class="compile">编辑</button>'
            },

            {
                check:'<input type="checkbox" class="checkchild"/>',
                '':'',
                'deviceNum':'n12123',
                'deviceType':'设备3',
                'beginTime' :'2017-04-04 14:18:20',
                'error' :'故障',
                'operator':'操作员c',
                'edit':'<button class="compile">编辑</button>'
            },
        ];
        var table=$('#table_id_example').DataTable({
            data:data,
            "columnDefs": [ {
                "searchable": false,
                "orderable": false,
                "targets": 0
            } ],
            "order": [[ 1, 'asc' ]],
            columns: [
                { data:'check',title:'选择'},
                { data: '',title:'序号' },
                { data: 'deviceNum',title:'设备编号' },
                { data: 'deviceType',title:'设备名称' },
                { data: 'beginTime' ,title:'发生时间'},
                { data: 'error' ,title:'报错信息'},
                { data: 'operator' ,title:'操作员'},
                { data: 'edit' ,title:'编辑'},
            ],
//            "displayStart": 20,
            lengthChange:false,
            info:false,
            lengthMenu:[20],
            language: {
                search:'模糊查询',
                "lengthMenu": "Display _MENU_ records per page",
                "zeroRecords": "对不起，没有查到您想要的结果",
                "info": " ",
                "infoEmpty": "No records available",
                "infoFiltered": "(filtered from _MAX_ total records)",
                "paginate": {
                    "first":      "首页",
                    "last":       "尾页",
                    "next":       "下一页",
                    "previous":   "上一页"
                }
            }
        });
        table.on('order.dt search.dt',
                function() {
                    table.column(1, {
                        search: 'applied',
                        order: 'applied'
                    }).nodes().each(function(cell, i) {
                        cell.innerHTML = i + 1;
                    });
                }).draw();
        $("#dimSearch").on("keyup change",function(){
            table.search(this.value).draw()
        });


        //        时间段选择
        var startTime='2010-01-01 00:00:00';
        var endTime='2111-01-01 00:00:00';
        $.fn.dataTable.ext.search.push(
                function( settings, data, dataIndex ) {
                    var start = Date.parse(startTime) / 1000;
                    var end = Date.parse(endTime) / 1000;
                    var time = Date.parse(new Date(data[4]))/1000 || 0;
                    var anomalyType=$("#anomalyType").val();
                    var anomalyContent=data[5];
                    if(anomalyType!="所有"){
                        if ( ( isNaN( start ) && isNaN( end ) ) ||
                            ( isNaN( start ) && time <= end ) ||
                            ( start <= time   && isNaN( end ) ) ||
                            ( start <= time   && time <= end )  &&
                            ( anomalyContent.indexOf(anomalyType)!=-1 )
                        )
                        {
                            return true;
                        }
                    }else{
                        if ( ( isNaN( start ) && isNaN( end ) ) ||
                            ( isNaN( start ) && time <= end ) ||
                            ( start <= time   && isNaN( end ) ) ||
                            ( start <= time   && time <= end )
                        )
                        {
                            return true;
                        }
                    }

                    return false;
                }
        );
//        点击新增
        var kg=0;
        var editIndex=null;
        $(".add").click(function(){
            kg=1;
            $(".cover").css('display','block');
        });
//        点击编辑
        $(".compile").click(function(){
            kg=2;
            $(".cover").css('display','block');
            var tr=$(this).parent().parent().children();
            editIndex=tr
            $("#equipmentNum").val(tr.eq(2).html());
            $("#equipmentName").val(tr.eq(3).html());
            $("#startTime").val(tr.eq(4).html());
            $("#master").val(tr.eq(6).html());
            $("#equipmentInfo").val(tr.eq(5).html());

        });
//        点击单个选中
        $(".checkchild").click(function(){
            console.log($(this).parent().parent())
            $(this).parent().parent().toggleClass('selected');
        });
//        点击删除
        $(".del").click(function(){
            table.row('.selected').remove().draw();
        });
//        点击保存
        var addTime='';
        $("#save").click(function(){
            $("#startTime").val('');
            if($("#equipmentNum").val()!=""&&$("#equipmentName").val()!=""&&addTime!=""&&$("#master").val()!=""&&$("#equipmentInfo").val()!=""){
                $(".cover").css('display','none');
                if(kg==1){
                    var item=[{
                        check:'<input type="checkbox" class="checkchild"/>',
                        '':'',
                        'deviceNum':'',
                        'deviceType':'',
                        'beginTime' :'',
                        'error' :'',
                        'operator':'',
                        'edit':'<button class="compile">编辑</button>'
                    }];
                    item[0].deviceNum=$("#equipmentNum").val();
                    item[0].deviceType=$("#equipmentName").val();
                    item[0].beginTime=addTime;
                    item[0].operator=$("#master").val();
                    item[0].error=$("#equipmentInfo").val();
                    table.rows.add(item).draw();

                }else if(kg==2){
                    editIndex.eq(2).html($("#equipmentNum").val());
                    editIndex.eq(3).html($("#equipmentName").val());
                    editIndex.eq(4).html($("#startTime").val());
                    editIndex.eq(6).html($("#master").val());
                    editIndex.eq(5).html($("#equipmentInfo").val());
                    editIndex=null;
                };
                $("#equipmentNum").val('');
                $("#equipmentName").val('');
                $("#startTime").val('');
                $("#master").val('');
//                $("#equipmentInfo").val('');
                kg=0;
            }else{
                alert("内容不完整，请填写完整保存")
            };
            setTimeout(function(){
                table.draw();
            },200)
        });
//        点击取消
        $("#cancel").click(function(){
            $(".cover").css('display','none');
            $("#equipmentNum").val('');
            $("#equipmentName").val('');
            $("#startTime").val('');
            $("#master").val('');
//            $("#equipmentInfo").val('');
        });
//        异常类型
        $("#anomalyType").change(function(){
            table.draw();
        });
//        时间控件
        jeDate("#start",{
            theme:{ bgcolor:"#00A1CB",color:"#ffffff", pnColor:"#00CCFF"},
            isinitVal:true  ,
            skinCell:"jedateblue",                      //日期风格样式，默认蓝色
            format:"YYYY-MM-DD hh:mm:ss",
            isTime:false,
            minDate:"2001-09-19 00:00:00",
            donefun:function(obj) {
                console.log(obj);
                startTime=obj.val;
                table.draw();
            }
        });
        jeDate("#end",{
            theme:{ bgcolor:"#00A1CB",color:"#ffffff", pnColor:"#00CCFF"},
            isinitVal:true,
            skinCell:"jedateblue",                      //日期风格样式，默认蓝色
            format:"YYYY-MM-DD hh:mm:ss",
            initDate:[{hh:23,mm:59,ss:59},false],
            isTime:false,
            minDate:"2001-09-19 00:00:00",
            donefun:function(obj) {
                console.log(obj);
                endTime=obj.val;
                table.draw();
            }
        });
//        弹出框时间控件、
        jeDate("#startTime",{
            theme:{ bgcolor:"#00A1CB",color:"#ffffff", pnColor:"#00CCFF"},
            isinitVal:true,
            skinCell:"jedateblue",                      //日期风格样式，默认蓝色
            format:"YYYY-MM-DD hh:mm:ss",
            isTime:false,
            minDate:"2001-09-19 00:00:00",
            donefun:function(obj) {
                addTime=obj.val;
                var nowTime=new Date();
                if(Date.parse(addTime)>Date.parse(nowTime)){
                    addTime="";

                };


            }
        });
        $("#startTime").val('');
    });
</script>
</html>